

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CMake Build System &mdash; Chimera SDK 2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=6fefd858"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API References" href="../api/api.html" />
    <link rel="prev" title="Folder Structure" href="structure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Chimera SDK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Folder Structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CMake Build System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mixed-isa-compilation">Mixed ISA Compilation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chimera SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CMake Build System</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/build.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cmake-build-system">
<h1>CMake Build System<a class="headerlink" href="#cmake-build-system" title="Link to this heading"></a></h1>
<p>All runtime functions executed by the host core are compiled into a dedicated <code class="docutils literal notranslate"><span class="pre">runtime_host</span></code> static library and the cluster code into <code class="docutils literal notranslate"><span class="pre">runtime_cluster_&lt;type&gt;</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">runtime_cluster_snitch</span></code>). Additionally, the HAL layer is compiled into the <code class="docutils literal notranslate"><span class="pre">hal_host</span></code> static libary.
The final binary is seperated into two object libaries, one for the host and one for the cluster core. The host object library is linked with the <code class="docutils literal notranslate"><span class="pre">runtime_host</span></code> and <code class="docutils literal notranslate"><span class="pre">hal_host</span></code> libraries, while the cluster object library is linked with the <code class="docutils literal notranslate"><span class="pre">runtime_cluster_&lt;type&gt;</span></code> library. The final binary is then linked from the two object libraries.</p>
<section id="mixed-isa-compilation">
<h2>Mixed ISA Compilation<a class="headerlink" href="#mixed-isa-compilation" title="Link to this heading"></a></h2>
<p>The current approach compiles all code for both the host and cluster cores into a single library. This requires precise handling to ensure compatibility between the different instruction set architectures (ISAs) and application binary interfaces (ABIs).
This requires careful handling to avoid invalid instructions caused by mismatched ISAs between the host and cluster cores. Hence, we define four CMake variables, <code class="docutils literal notranslate"><span class="pre">ABI</span></code>, <code class="docutils literal notranslate"><span class="pre">ISA_HOST</span></code>, and <code class="docutils literal notranslate"><span class="pre">ISA_CLUSTER_SNITCH</span></code>, to specify the appropriate ISA for each core type. The ABI has to be identical to ensure correct function calls.
Furthermore, the tests are split into <code class="docutils literal notranslate"><span class="pre">src_host</span></code> and <code class="docutils literal notranslate"><span class="pre">src_cluster</span></code> directories to clearly separate code executed on the host and cluster cores.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Special attention is required for functions that execute before the cluster core is fully initialized, such as the trampoline function and interrupt handlers. At this stage, critical resources like the stack, global pointer, and thread pointer are not yet configured. Consequently, the compiler must not generate code that allocates stack frames. To address this, such functions are implemented as naked functions, which prevent the compiler from adding prologues or epilogues that rely on stack operations.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>It is recommended to always check the generated assembly code to ensure that the correct instructions are generated for the target core!</strong></p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="structure.html" class="btn btn-neutral float-left" title="Folder Structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/api.html" class="btn btn-neutral float-right" title="API References" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Philip Wiese, Moritz Scherer, Viviane Potocnik.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: vivianep/opentitan-peripherals
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    
    <dl>
      <dt>Versions</dt>
      
      <dd><a href="https://pulp-platform.github.io/chimera-sdk//index.html">master</a></dd>
      
      <dd><a href="https://pulp-platform.github.io/chimera-sdk/branch/devel//index.html">devel</a></dd>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>